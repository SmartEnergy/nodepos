<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>nodePos Socket Client Example</title>
        <!-- Be sure nodePos is running on localhost:8000 -->
        <script src="http://localhost:8000/socket.io/socket.io.js"></script>
        <script>

           /*
            *   Say what to do with your application...
            *   See /data/area.js for the attributes.
            *   user attributes are defined in some protocol in trac ;)
            */
            function onUserIn(user, area) {
               // alert('User in area ' + area.name);
            }

            function onUserOut(user, area) {
                //alert('User out of area ' + area.name);
            }

            function onNewUser(user) {
//                alert('NewUser | ID: ' + user.id + ' X: ' + user.position.x + ' Y: ' + user.position.y );
            }

            function onRemovedUser(user) {
  //              alert('RemovedUser | ID: ' + user.id);
            }

            function onUpdateUser(user) {
    //            alert('New position of user ' + user.id);
            }

            /* Be sure nodePos is running on localhost:8000 */
            var socket = new io.Socket('localhost',{'port':8000});
            // establish connection
            socket.connect();

            socket.on('connect', function(){ 
                document.getElementById('connection').innerHTML = '<h1>Connected to nodePos</h1>';

		socket.send(JSON.stringify({ method: 'region', regions: [ { name: 2,  posX: 0, posY: 0, width: 1000, height: 1000, action: [ { id: 1, event: 'userrIn', action: 'lightOneOff'} ] } ] }));
            });

            socket.on('message', function(data){
                var msg = JSON.parse(data);
                var event = msg.event;
                switch(event) {
                    case 'userIn':
                        onUserIn(msg.user, msg.area);
                        break;
                    case 'userOut':
                        onUserOut(msg.user, msg.area);
                        break;
                    case 'newUser':
                        onNewUser(msg.user);
                        break;
                    case 'updateUser':
                        onUpdateUser(msg.user);
                        break;
                    case 'removedUser':
                        onRemovedUser(msg.user);
                        break;
                    case 'loadScenes':
                        alert('loaded scene.. ' + msg.scenes[0].sceneName);
                        break;
                    case 'scenes':
//                        onRemovedUser(msg.user);
                        break;
                    default:
                        alert('Unsupported Event Type..');
                        break;
                }
            });

            socket.on('disconnect', function(){ 
                document.getElementById('connection').innerHTML = '<h1>No connection to nodePos</h1>';
            });
        </script>
    </head>
    <body>
        <div id="connection">
            <h1>No connection to nodePos</h1>
        </div>
</html>
